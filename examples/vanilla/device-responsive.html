<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®¾å¤‡å“åº”å¼å’Œ HTML æ¸²æŸ“å™¨ä¿®å¤ - Lottie Demo</title>
  <link rel="stylesheet" href="../../src/styles/html-renderer-fix.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 16px;
      opacity: 0.9;
    }

    .device-info {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .device-info h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #333;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .info-item {
      background: #f5f5f5;
      padding: 12px;
      border-radius: 8px;
    }

    .info-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-value {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
    }

    .badge-high {
      background: #4caf50;
      color: white;
    }

    .badge-medium {
      background: #ff9800;
      color: white;
    }

    .badge-low {
      background: #f44336;
      color: white;
    }

    .badge-desktop {
      background: #2196f3;
      color: white;
    }

    .badge-tablet {
      background: #9c27b0;
      color: white;
    }

    .badge-mobile {
      background: #00bcd4;
      color: white;
    }

    .demo-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .demo-section h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }

    .renderer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .renderer-item {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      transition: all 0.3s ease;
    }

    .renderer-item:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .renderer-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 10px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .lottie-container {
      width: 100%;
      height: 250px;
      background: #f9f9f9;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .metrics {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #e0e0e0;
    }

    .metric {
      text-align: center;
    }

    .metric-label {
      font-size: 11px;
      color: #999;
      margin-bottom: 3px;
    }

    .metric-value {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    .stats-display {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 24px;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .renderer-grid {
        grid-template-columns: 1fr;
      }

      .lottie-container {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ è®¾å¤‡å“åº”å¼å’Œ HTML æ¸²æŸ“å™¨ä¿®å¤</h1>
      <p>è‡ªåŠ¨æ£€æµ‹è®¾å¤‡ç±»å‹å’Œæ€§èƒ½ç­‰çº§ï¼Œä¼˜åŒ–æ¸²æŸ“æ–¹å¼å’Œæ€§èƒ½</p>
    </div>

    <!-- è®¾å¤‡ä¿¡æ¯ -->
    <div class="device-info">
      <h2>ğŸ“± å½“å‰è®¾å¤‡ä¿¡æ¯</h2>
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">è®¾å¤‡ç±»å‹</div>
          <div class="info-value" id="deviceType">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">æ€§èƒ½ç­‰çº§</div>
          <div class="info-value" id="performanceTier">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">æ¨èæ¸²æŸ“å™¨</div>
          <div class="info-value" id="recommendedRenderer">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">å±å¹•åˆ†è¾¨ç‡</div>
          <div class="info-value" id="screenResolution">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">è®¾å¤‡åƒç´ æ¯”</div>
          <div class="info-value" id="devicePixelRatio">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">CPU æ ¸å¿ƒæ•°</div>
          <div class="info-value" id="cpuCores">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">å†…å­˜</div>
          <div class="info-value" id="memory">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">WebGL æ”¯æŒ</div>
          <div class="info-value" id="webglSupport">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">æ¨è FPS</div>
          <div class="info-value" id="recommendedFPS">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">è§¦æ‘¸æ”¯æŒ</div>
          <div class="info-value" id="touchSupport">-</div>
        </div>
      </div>
    </div>

    <!-- æ¸²æŸ“å™¨å¯¹æ¯” -->
    <div class="demo-section">
      <h3>ğŸ¨ æ¸²æŸ“å™¨æ€§èƒ½å¯¹æ¯”</h3>
      <div class="renderer-grid">
        <!-- SVG æ¸²æŸ“å™¨ -->
        <div class="renderer-item">
          <div class="renderer-title">SVG æ¸²æŸ“å™¨</div>
          <div class="lottie-container" id="svg-container"></div>
          <div class="metrics">
            <div class="metric">
              <div class="metric-label">FPS</div>
              <div class="metric-value" id="svg-fps">0</div>
            </div>
            <div class="metric">
              <div class="metric-label">å†…å­˜</div>
              <div class="metric-value" id="svg-memory">0 MB</div>
            </div>
          </div>
        </div>

        <!-- Canvas æ¸²æŸ“å™¨ -->
        <div class="renderer-item">
          <div class="renderer-title">Canvas æ¸²æŸ“å™¨</div>
          <div class="lottie-container" id="canvas-container"></div>
          <div class="metrics">
            <div class="metric">
              <div class="metric-label">FPS</div>
              <div class="metric-value" id="canvas-fps">0</div>
            </div>
            <div class="metric">
              <div class="metric-label">å†…å­˜</div>
              <div class="metric-value" id="canvas-memory">0 MB</div>
            </div>
          </div>
        </div>

        <!-- HTML æ¸²æŸ“å™¨ (å·²ä¿®å¤) -->
        <div class="renderer-item">
          <div class="renderer-title">HTML æ¸²æŸ“å™¨ (å·²ä¿®å¤)</div>
          <div class="lottie-container lottie-html-container" id="html-container">
            <div class="lottie-html" id="html-inner"></div>
          </div>
          <div class="metrics">
            <div class="metric">
              <div class="metric-label">FPS</div>
              <div class="metric-value" id="html-fps">0</div>
            </div>
            <div class="metric">
              <div class="metric-label">å†…å­˜</div>
              <div class="metric-value" id="html-memory">0 MB</div>
            </div>
          </div>
        </div>
      </div>

      <!-- æ§åˆ¶æŒ‰é’® -->
      <div class="controls">
        <button class="btn btn-primary" onclick="playAll()">â–¶ï¸ å…¨éƒ¨æ’­æ”¾</button>
        <button class="btn btn-primary" onclick="pauseAll()">â¸ï¸ å…¨éƒ¨æš‚åœ</button>
        <button class="btn btn-primary" onclick="stopAll()">â¹ï¸ å…¨éƒ¨åœæ­¢</button>
        <button class="btn btn-secondary" onclick="autoOptimize()">ğŸš€ è‡ªåŠ¨ä¼˜åŒ–</button>
        <button class="btn btn-secondary" onclick="refreshDevice()">ğŸ”„ åˆ·æ–°è®¾å¤‡ä¿¡æ¯</button>
      </div>

      <!-- å…¨å±€ç»Ÿè®¡ -->
      <div class="stats-display">
        <h4 style="margin-bottom: 10px;">ğŸ“Š å…¨å±€ç»Ÿè®¡</h4>
        <div class="stats-grid">
          <div class="info-item">
            <div class="info-label">æ€»å®ä¾‹æ•°</div>
            <div class="info-value" id="totalInstances">0</div>
          </div>
          <div class="info-item">
            <div class="info-label">æ´»è·ƒå®ä¾‹</div>
            <div class="info-value" id="activeInstances">0</div>
          </div>
          <div class="info-item">
            <div class="info-label">å¹³å‡ FPS</div>
            <div class="info-value" id="avgFps">0</div>
          </div>
          <div class="info-item">
            <div class="info-label">æ€»å†…å­˜</div>
            <div class="info-value" id="totalMemory">0 MB</div>
          </div>
        </div>
      </div>
    </div>

    <!-- å“åº”å¼ç¤ºä¾‹ -->
    <div class="demo-section">
      <h3>ğŸ“ å“åº”å¼å®¹å™¨ç¤ºä¾‹</h3>
      <div class="renderer-grid">
        <div class="renderer-item">
          <div class="renderer-title">1:1 æ­£æ–¹å½¢</div>
          <div class="lottie-responsive">
            <div class="lottie-html" id="responsive-1-1"></div>
          </div>
        </div>
        <div class="renderer-item">
          <div class="renderer-title">16:9 å®½å±</div>
          <div class="lottie-responsive lottie-responsive-16-9">
            <div class="lottie-html" id="responsive-16-9"></div>
          </div>
        </div>
        <div class="renderer-item">
          <div class="renderer-title">4:3 æ ‡å‡†</div>
          <div class="lottie-responsive lottie-responsive-4-3">
            <div class="lottie-html" id="responsive-4-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { lottieManager, getDeviceInfo, getRecommendedConfig } from '../../dist/index.js'

    // å…¨å±€å®ä¾‹å­˜å‚¨
    window.instances = {
      svg: null,
      canvas: null,
      html: null,
      responsive: []
    }

    // æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯
    function displayDeviceInfo() {
      const deviceInfo = getDeviceInfo()
      const recommended = getRecommendedConfig()

      // è®¾å¤‡ç±»å‹
      const typeMap = {
        desktop: '<span class="badge badge-desktop">æ¡Œé¢è®¾å¤‡</span>',
        tablet: '<span class="badge badge-tablet">å¹³æ¿è®¾å¤‡</span>',
        mobile: '<span class="badge badge-mobile">ç§»åŠ¨è®¾å¤‡</span>'
      }
      document.getElementById('deviceType').innerHTML = typeMap[deviceInfo.type]

      // æ€§èƒ½ç­‰çº§
      const tierMap = {
        high: '<span class="badge badge-high">é«˜æ€§èƒ½</span>',
        medium: '<span class="badge badge-medium">ä¸­ç­‰æ€§èƒ½</span>',
        low: '<span class="badge badge-low">ä½æ€§èƒ½</span>'
      }
      document.getElementById('performanceTier').innerHTML = tierMap[deviceInfo.performanceTier]

      // å…¶ä»–ä¿¡æ¯
      document.getElementById('recommendedRenderer').textContent = recommended.renderer.toUpperCase()
      document.getElementById('screenResolution').textContent = `${deviceInfo.screenWidth} Ã— ${deviceInfo.screenHeight}`
      document.getElementById('devicePixelRatio').textContent = deviceInfo.devicePixelRatio.toFixed(1)
      document.getElementById('cpuCores').textContent = deviceInfo.hardwareConcurrency
      document.getElementById('memory').textContent = deviceInfo.memory ? `${deviceInfo.memory} GB` : 'æœªçŸ¥'
      document.getElementById('webglSupport').textContent = deviceInfo.supportsWebGL ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'
      document.getElementById('recommendedFPS').textContent = recommended.targetFPS
      document.getElementById('touchSupport').textContent = deviceInfo.isTouch ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'
    }

    // åˆå§‹åŒ– SVG æ¸²æŸ“å™¨
    window.instances.svg = lottieManager.create({
      container: document.getElementById('svg-container'),
      path: '../animations/heart-beat.json',
      renderer: 'svg',
      loop: true,
      autoplay: true,
      name: 'SVG Example',
      advanced: {
        enablePerformanceMonitor: true,
        targetFPS: 60
      }
    })

    // åˆå§‹åŒ– Canvas æ¸²æŸ“å™¨
    window.instances.canvas = lottieManager.create({
      container: document.getElementById('canvas-container'),
      path: '../animations/heart-beat.json',
      renderer: 'canvas',
      loop: true,
      autoplay: true,
      name: 'Canvas Example',
      advanced: {
        enablePerformanceMonitor: true,
        targetFPS: 60
      }
    })

    // åˆå§‹åŒ– HTML æ¸²æŸ“å™¨ï¼ˆå·²ä¿®å¤ï¼‰
    window.instances.html = lottieManager.create({
      container: document.getElementById('html-inner'),
      path: '../animations/heart-beat.json',
      renderer: 'html',
      loop: true,
      autoplay: true,
      name: 'HTML Example',
      rendererSettings: {
        className: 'lottie-html',
        hideOnTransparent: true
      },
      advanced: {
        enablePerformanceMonitor: true,
        targetFPS: 60
      }
    })

    // åˆå§‹åŒ–å“åº”å¼å®ä¾‹
    const responsiveIds = ['responsive-1-1', 'responsive-16-9', 'responsive-4-3']
    responsiveIds.forEach(id => {
      const instance = lottieManager.create({
        container: document.getElementById(id),
        path: '../animations/rocket.json',
        renderer: 'svg',
        loop: true,
        autoplay: true,
        name: `Responsive ${id}`
      })
      window.instances.responsive.push(instance)
    })

    // åŠ è½½æ‰€æœ‰å®ä¾‹
    Promise.all([
      window.instances.svg.load(),
      window.instances.canvas.load(),
      window.instances.html.load(),
      ...window.instances.responsive.map(i => i.load())
    ]).then(() => {
      console.log('æ‰€æœ‰åŠ¨ç”»å·²åŠ è½½')
      updateMetrics()
    })

    // æ›´æ–°æ€§èƒ½æŒ‡æ ‡
    function updateMetrics() {
      // SVG æŒ‡æ ‡
      const svgMetrics = window.instances.svg.getMetrics()
      if (svgMetrics) {
        document.getElementById('svg-fps').textContent = Math.round(svgMetrics.fps)
        document.getElementById('svg-memory').textContent = svgMetrics.memory.toFixed(2)
      }

      // Canvas æŒ‡æ ‡
      const canvasMetrics = window.instances.canvas.getMetrics()
      if (canvasMetrics) {
        document.getElementById('canvas-fps').textContent = Math.round(canvasMetrics.fps)
        document.getElementById('canvas-memory').textContent = canvasMetrics.memory.toFixed(2)
      }

      // HTML æŒ‡æ ‡
      const htmlMetrics = window.instances.html.getMetrics()
      if (htmlMetrics) {
        document.getElementById('html-fps').textContent = Math.round(htmlMetrics.fps)
        document.getElementById('html-memory').textContent = htmlMetrics.memory.toFixed(2)
      }

      // å…¨å±€ç»Ÿè®¡
      const globalStats = lottieManager.getGlobalStats()
      document.getElementById('totalInstances').textContent = globalStats.totalInstances
      document.getElementById('activeInstances').textContent = globalStats.activeInstances
      document.getElementById('avgFps').textContent = globalStats.averageFps
      document.getElementById('totalMemory').textContent = globalStats.totalMemory.toFixed(2)

      requestAnimationFrame(updateMetrics)
    }

    // å…¨å±€æ§åˆ¶å‡½æ•°
    window.playAll = function() {
      lottieManager.playAll()
    }

    window.pauseAll = function() {
      lottieManager.pauseAll()
    }

    window.stopAll = function() {
      lottieManager.stopAll()
    }

    window.autoOptimize = function() {
      const result = lottieManager.autoOptimize()
      alert(`ä¼˜åŒ–å®Œæˆï¼\næ¸…ç†äº† ${result.optimized} ä¸ªå®ä¾‹\né™çº§äº† ${result.downgraded} ä¸ªå®ä¾‹`)
    }

    window.refreshDevice = function() {
      displayDeviceInfo()
      alert('è®¾å¤‡ä¿¡æ¯å·²åˆ·æ–°ï¼')
    }

    // åˆå§‹åŒ–æ˜¾ç¤º
    displayDeviceInfo()
  </script>
</body>
</html>
