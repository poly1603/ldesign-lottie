<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>设备响应式和 HTML 渲染器修复 - Lottie Demo</title>
  <link rel="stylesheet" href="../../src/styles/html-renderer-fix.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      color: white;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .header p {
      font-size: 16px;
      opacity: 0.9;
    }

    .device-info {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .device-info h2 {
      font-size: 20px;
      margin-bottom: 15px;
      color: #333;
    }

    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .info-item {
      background: #f5f5f5;
      padding: 12px;
      border-radius: 8px;
    }

    .info-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-value {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
    }

    .badge-high {
      background: #4caf50;
      color: white;
    }

    .badge-medium {
      background: #ff9800;
      color: white;
    }

    .badge-low {
      background: #f44336;
      color: white;
    }

    .badge-desktop {
      background: #2196f3;
      color: white;
    }

    .badge-tablet {
      background: #9c27b0;
      color: white;
    }

    .badge-mobile {
      background: #00bcd4;
      color: white;
    }

    .demo-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .demo-section h3 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }

    .renderer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .renderer-item {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      transition: all 0.3s ease;
    }

    .renderer-item:hover {
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .renderer-title {
      font-size: 14px;
      font-weight: 600;
      color: #666;
      margin-bottom: 10px;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .lottie-container {
      width: 100%;
      height: 250px;
      background: #f9f9f9;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .metrics {
      display: flex;
      justify-content: space-around;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #e0e0e0;
    }

    .metric {
      text-align: center;
    }

    .metric-label {
      font-size: 11px;
      color: #999;
      margin-bottom: 3px;
    }

    .metric-value {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn-primary {
      background: #667eea;
      color: white;
    }

    .btn-primary:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .btn-secondary {
      background: #e0e0e0;
      color: #333;
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    .stats-display {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 24px;
      }

      .info-grid {
        grid-template-columns: 1fr;
      }

      .renderer-grid {
        grid-template-columns: 1fr;
      }

      .lottie-container {
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🎯 设备响应式和 HTML 渲染器修复</h1>
      <p>自动检测设备类型和性能等级，优化渲染方式和性能</p>
    </div>

    <!-- 设备信息 -->
    <div class="device-info">
      <h2>📱 当前设备信息</h2>
      <div class="info-grid">
        <div class="info-item">
          <div class="info-label">设备类型</div>
          <div class="info-value" id="deviceType">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">性能等级</div>
          <div class="info-value" id="performanceTier">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">推荐渲染器</div>
          <div class="info-value" id="recommendedRenderer">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">屏幕分辨率</div>
          <div class="info-value" id="screenResolution">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">设备像素比</div>
          <div class="info-value" id="devicePixelRatio">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">CPU 核心数</div>
          <div class="info-value" id="cpuCores">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">内存</div>
          <div class="info-value" id="memory">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">WebGL 支持</div>
          <div class="info-value" id="webglSupport">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">推荐 FPS</div>
          <div class="info-value" id="recommendedFPS">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">触摸支持</div>
          <div class="info-value" id="touchSupport">-</div>
        </div>
      </div>
    </div>

    <!-- 渲染器对比 -->
    <div class="demo-section">
      <h3>🎨 渲染器性能对比</h3>
      <div class="renderer-grid">
        <!-- SVG 渲染器 -->
        <div class="renderer-item">
          <div class="renderer-title">SVG 渲染器</div>
          <div class="lottie-container" id="svg-container"></div>
          <div class="metrics">
            <div class="metric">
              <div class="metric-label">FPS</div>
              <div class="metric-value" id="svg-fps">0</div>
            </div>
            <div class="metric">
              <div class="metric-label">内存</div>
              <div class="metric-value" id="svg-memory">0 MB</div>
            </div>
          </div>
        </div>

        <!-- Canvas 渲染器 -->
        <div class="renderer-item">
          <div class="renderer-title">Canvas 渲染器</div>
          <div class="lottie-container" id="canvas-container"></div>
          <div class="metrics">
            <div class="metric">
              <div class="metric-label">FPS</div>
              <div class="metric-value" id="canvas-fps">0</div>
            </div>
            <div class="metric">
              <div class="metric-label">内存</div>
              <div class="metric-value" id="canvas-memory">0 MB</div>
            </div>
          </div>
        </div>

        <!-- HTML 渲染器 (已修复) -->
        <div class="renderer-item">
          <div class="renderer-title">HTML 渲染器 (已修复)</div>
          <div class="lottie-container lottie-html-container" id="html-container">
            <div class="lottie-html" id="html-inner"></div>
          </div>
          <div class="metrics">
            <div class="metric">
              <div class="metric-label">FPS</div>
              <div class="metric-value" id="html-fps">0</div>
            </div>
            <div class="metric">
              <div class="metric-label">内存</div>
              <div class="metric-value" id="html-memory">0 MB</div>
            </div>
          </div>
        </div>
      </div>

      <!-- 控制按钮 -->
      <div class="controls">
        <button class="btn btn-primary" onclick="playAll()">▶️ 全部播放</button>
        <button class="btn btn-primary" onclick="pauseAll()">⏸️ 全部暂停</button>
        <button class="btn btn-primary" onclick="stopAll()">⏹️ 全部停止</button>
        <button class="btn btn-secondary" onclick="autoOptimize()">🚀 自动优化</button>
        <button class="btn btn-secondary" onclick="refreshDevice()">🔄 刷新设备信息</button>
      </div>

      <!-- 全局统计 -->
      <div class="stats-display">
        <h4 style="margin-bottom: 10px;">📊 全局统计</h4>
        <div class="stats-grid">
          <div class="info-item">
            <div class="info-label">总实例数</div>
            <div class="info-value" id="totalInstances">0</div>
          </div>
          <div class="info-item">
            <div class="info-label">活跃实例</div>
            <div class="info-value" id="activeInstances">0</div>
          </div>
          <div class="info-item">
            <div class="info-label">平均 FPS</div>
            <div class="info-value" id="avgFps">0</div>
          </div>
          <div class="info-item">
            <div class="info-label">总内存</div>
            <div class="info-value" id="totalMemory">0 MB</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 响应式示例 -->
    <div class="demo-section">
      <h3>📐 响应式容器示例</h3>
      <div class="renderer-grid">
        <div class="renderer-item">
          <div class="renderer-title">1:1 正方形</div>
          <div class="lottie-responsive">
            <div class="lottie-html" id="responsive-1-1"></div>
          </div>
        </div>
        <div class="renderer-item">
          <div class="renderer-title">16:9 宽屏</div>
          <div class="lottie-responsive lottie-responsive-16-9">
            <div class="lottie-html" id="responsive-16-9"></div>
          </div>
        </div>
        <div class="renderer-item">
          <div class="renderer-title">4:3 标准</div>
          <div class="lottie-responsive lottie-responsive-4-3">
            <div class="lottie-html" id="responsive-4-3"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { lottieManager, getDeviceInfo, getRecommendedConfig } from '../../dist/index.js'

    // 全局实例存储
    window.instances = {
      svg: null,
      canvas: null,
      html: null,
      responsive: []
    }

    // 显示设备信息
    function displayDeviceInfo() {
      const deviceInfo = getDeviceInfo()
      const recommended = getRecommendedConfig()

      // 设备类型
      const typeMap = {
        desktop: '<span class="badge badge-desktop">桌面设备</span>',
        tablet: '<span class="badge badge-tablet">平板设备</span>',
        mobile: '<span class="badge badge-mobile">移动设备</span>'
      }
      document.getElementById('deviceType').innerHTML = typeMap[deviceInfo.type]

      // 性能等级
      const tierMap = {
        high: '<span class="badge badge-high">高性能</span>',
        medium: '<span class="badge badge-medium">中等性能</span>',
        low: '<span class="badge badge-low">低性能</span>'
      }
      document.getElementById('performanceTier').innerHTML = tierMap[deviceInfo.performanceTier]

      // 其他信息
      document.getElementById('recommendedRenderer').textContent = recommended.renderer.toUpperCase()
      document.getElementById('screenResolution').textContent = `${deviceInfo.screenWidth} × ${deviceInfo.screenHeight}`
      document.getElementById('devicePixelRatio').textContent = deviceInfo.devicePixelRatio.toFixed(1)
      document.getElementById('cpuCores').textContent = deviceInfo.hardwareConcurrency
      document.getElementById('memory').textContent = deviceInfo.memory ? `${deviceInfo.memory} GB` : '未知'
      document.getElementById('webglSupport').textContent = deviceInfo.supportsWebGL ? '✅ 支持' : '❌ 不支持'
      document.getElementById('recommendedFPS').textContent = recommended.targetFPS
      document.getElementById('touchSupport').textContent = deviceInfo.isTouch ? '✅ 支持' : '❌ 不支持'
    }

    // 初始化 SVG 渲染器
    window.instances.svg = lottieManager.create({
      container: document.getElementById('svg-container'),
      path: '../animations/heart-beat.json',
      renderer: 'svg',
      loop: true,
      autoplay: true,
      name: 'SVG Example',
      advanced: {
        enablePerformanceMonitor: true,
        targetFPS: 60
      }
    })

    // 初始化 Canvas 渲染器
    window.instances.canvas = lottieManager.create({
      container: document.getElementById('canvas-container'),
      path: '../animations/heart-beat.json',
      renderer: 'canvas',
      loop: true,
      autoplay: true,
      name: 'Canvas Example',
      advanced: {
        enablePerformanceMonitor: true,
        targetFPS: 60
      }
    })

    // 初始化 HTML 渲染器（已修复）
    window.instances.html = lottieManager.create({
      container: document.getElementById('html-inner'),
      path: '../animations/heart-beat.json',
      renderer: 'html',
      loop: true,
      autoplay: true,
      name: 'HTML Example',
      rendererSettings: {
        className: 'lottie-html',
        hideOnTransparent: true
      },
      advanced: {
        enablePerformanceMonitor: true,
        targetFPS: 60
      }
    })

    // 初始化响应式实例
    const responsiveIds = ['responsive-1-1', 'responsive-16-9', 'responsive-4-3']
    responsiveIds.forEach(id => {
      const instance = lottieManager.create({
        container: document.getElementById(id),
        path: '../animations/rocket.json',
        renderer: 'svg',
        loop: true,
        autoplay: true,
        name: `Responsive ${id}`
      })
      window.instances.responsive.push(instance)
    })

    // 加载所有实例
    Promise.all([
      window.instances.svg.load(),
      window.instances.canvas.load(),
      window.instances.html.load(),
      ...window.instances.responsive.map(i => i.load())
    ]).then(() => {
      console.log('所有动画已加载')
      updateMetrics()
    })

    // 更新性能指标
    function updateMetrics() {
      // SVG 指标
      const svgMetrics = window.instances.svg.getMetrics()
      if (svgMetrics) {
        document.getElementById('svg-fps').textContent = Math.round(svgMetrics.fps)
        document.getElementById('svg-memory').textContent = svgMetrics.memory.toFixed(2)
      }

      // Canvas 指标
      const canvasMetrics = window.instances.canvas.getMetrics()
      if (canvasMetrics) {
        document.getElementById('canvas-fps').textContent = Math.round(canvasMetrics.fps)
        document.getElementById('canvas-memory').textContent = canvasMetrics.memory.toFixed(2)
      }

      // HTML 指标
      const htmlMetrics = window.instances.html.getMetrics()
      if (htmlMetrics) {
        document.getElementById('html-fps').textContent = Math.round(htmlMetrics.fps)
        document.getElementById('html-memory').textContent = htmlMetrics.memory.toFixed(2)
      }

      // 全局统计
      const globalStats = lottieManager.getGlobalStats()
      document.getElementById('totalInstances').textContent = globalStats.totalInstances
      document.getElementById('activeInstances').textContent = globalStats.activeInstances
      document.getElementById('avgFps').textContent = globalStats.averageFps
      document.getElementById('totalMemory').textContent = globalStats.totalMemory.toFixed(2)

      requestAnimationFrame(updateMetrics)
    }

    // 全局控制函数
    window.playAll = function() {
      lottieManager.playAll()
    }

    window.pauseAll = function() {
      lottieManager.pauseAll()
    }

    window.stopAll = function() {
      lottieManager.stopAll()
    }

    window.autoOptimize = function() {
      const result = lottieManager.autoOptimize()
      alert(`优化完成！\n清理了 ${result.optimized} 个实例\n降级了 ${result.downgraded} 个实例`)
    }

    window.refreshDevice = function() {
      displayDeviceInfo()
      alert('设备信息已刷新！')
    }

    // 初始化显示
    displayDeviceInfo()
  </script>
</body>
</html>
